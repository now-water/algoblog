---
title: '(3) μΏΌλ¦¬ λ©”μ†λ“ κΈ°λ¥'
metaTitle: 'λ§λ ™ κ°λ°μ ν‚¤μ°κΈ°'
metaDescription: 'μΏΌλ¦¬ λ©”μ†λ“ κΈ°λ¥μ„ μ •λ¦¬ν• κ³³μ…λ‹λ‹¤.'
tags: ['Spring Boot JPA']
date: '2021-01-31'
---

# μΏΌλ¦¬ λ©”μ†λ“ κΈ°λ¥

- μ¤ν”„λ§ λ°μ΄ν„° JPAκ°€ μ κ³µν•λ” λ§λ²•κ°™μ€ κΈ°λ¥μ΄λ‹¤.

- λ©”μ†λ“ μ΄λ¦„λ§μΌλ΅ μΏΌλ¦¬λ¥Ό μƒμ„±ν•λ” κΈ°λ¥μ΄ μ΅΄μ¬ν•λ‹¤.
  > μΈν„°νμ΄μ¤ λ©”μ†λ“λ§ μ„ μ–Έν•λ©΄ λ©”μ†λ“ μ΄λ¦„μΌλ΅ JPQL μΏΌλ¦¬λ¥Ό μƒμ„±ν•΄μ„ μ‹¤ν–‰ν•λ‹¤.

---

### μ¤ν”„λ§ λ°μ΄ν„° JPAκ°€ μ κ³µν•λ” μΏΌλ¦¬ λ©”μ†λ“ κΈ°λ¥

- λ©”μ†λ“ μ΄λ¦„μΌλ΅ μΏΌλ¦¬ μƒμ„±

* λ©”μ†λ“ μ΄λ¦„μΌλ΅ JPA NamedQuery νΈμ¶

- @Query μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•΄μ„ Repository μΈν„°νμ΄μ¤μ— μΏΌλ¦¬ μ§μ ‘ μ •μ

<br/>
π¶ μ΄ κΈ°λ¥λ“¤μ„ ν™μ©ν•λ©΄ μΈν„°νμ΄μ¤λ§μΌλ΅ ν•„μ”ν• λ€λ¶€λ¶„μ μΏΌλ¦¬ κΈ°λ¥μ„ κ°λ°ν•  μ μλ‹¤.

---

## λ©”μ†λ“ μ΄λ¦„μΌλ΅ μΏΌλ¦¬ μƒμ„±ν•κΈ°

μ •ν•΄μ§„ κ·μΉ™μ— λ”°λΌμ„ λ©”μ†λ“ μ΄λ¦„μ„ μ§€μ–΄μ•Ό ν•λ‹¤.

[[μΏΌλ¦¬ μƒμ„± κΈ°λ¥ μ°Έκ³ ](http://docs.spring.io/spring-data/jpa/docs/1.3.0.RELEASE/reference/html/jpa.repositories.html)]

```java
// μ΄λ©”μΌκ³Ό μ΄λ¦„μΌλ΅ νμ› μ΅°ν

public interface MemberRepository extends Repository<Member, Long> {
  List<Member> findByEmailAndName(String email, String name);
}
```

μ„μ λ©”μ†λ“λ¥Ό μ‹¤ν–‰ν•λ©΄ μ¤ν”„λ§ λ°μ΄ν„° JPAλ” `λ©”μ†λ“ μ΄λ¦„`μ„ λ¶„μ„ν•΄μ„ JPQLμ„ μƒμ„±ν•κ³  μ‹¤ν–‰ν•λ‹¤.

```java
select m from Member m where m.email = ?1 and m.name = ?2
```

- μ—”ν‹°ν‹°μ ν•„λ“λ…μ΄ λ³€κ²½λλ©΄ μΈν„°νμ΄μ¤μ— μ •μν• λ©”μ†λ“ μ΄λ¦„λ„ κΌ­ ν•¨κ» λ³€κ²½ν•΄μ•Ό ν•λ‹¤.

* κ·Έλ ‡μ§€ μ•μΌλ©΄ μ• ν”λ¦¬μΌ€μ΄μ… μ‹μ‘ μ‹μ μ— μ¤λ¥κ°€ λ°μƒν•λ‹¤.

---

## JPA NamedQuery

- μ¤ν”„λ§ λ°μ΄ν„° JPAλ” λ©”μ†λ“ μ΄λ¦„μΌλ΅ JPA Named μΏΌλ¦¬λ¥Ό νΈμ¶ν•λ” κΈ°λ¥ μ κ³µ

* JPA Named μΏΌλ¦¬ : μ΄λ¦„ κ·Έλ€λ΅ μΏΌλ¦¬μ— μ΄λ¦„μ„ λ¶€μ—¬ν•΄μ„ μ‚¬μ©ν•λ” λ°©λ²• -> μ• λ…Έν…μ΄μ…μ΄λ‚ XML μ— μΏΌλ¦¬λ¥Ό μ •μν•  μ μλ‹¤.

```java
  // @NamedQuery μ• λ…Έν…μ΄μ…μΌλ΅ Named μΏΌλ¦¬ μ •μ
  @Entity
  @NamedQuery(
    name="Member.findByUsername",
    query="select m from Member m where m.username = :username")
  public class Member {
    ...
  }
```

<br/>

- νΉμ€ `MemberRepository` μ—μ„ JPAλ¥Ό μ§μ ‘ μ‚¬μ©ν•΄μ„ Named μΏΌλ¦¬ νΈμ¶ν•  μ λ„ μλ‹¤.

```java
public class MemberRepository {
  // JPA μ§μ ‘ μ‚¬μ©ν•΄μ„ Named μΏΌλ¦¬ νΈμ¶
  public List<Member> findByUsername(String username) {
    ...
  }
}
```

<br/>

- μ¤ν”„λ§ λ°μ΄ν„° JPA λ΅ Named μΏΌλ¦¬ νΈμ¶

  : "λ„λ©”μΈ ν΄λμ¤.λ©”μ†λ“ μ΄λ¦„" μΌλ΅ Named μΏΌλ¦¬λ¥Ό μ°Ύμ•„ μ‹¤ν–‰ν•¨.

```java
public interface MemberRepository extends JpaRepository<Member, Long> { // μ—¬κΈ° μ„ μ–Έν• Member λ„λ©”μΈ ν΄λμ¤λ¥Ό μ΄μ©

  List<Member> findByUsername(@Param("username") String username); // @Param : μ΄λ¦„κΈ°λ° νλΌλ―Έν„° λ°”μΈλ”©
}
```

---

## @Query, λ¦¬ν¬μ§€ν† λ¦¬ λ©”μ†λ“μ— μΏΌλ¦¬ μ •μ

- λ¦¬ν¬μ§€ν† λ¦¬ λ©”μ†λ“μ— μ§μ ‘ μΏΌλ¦¬λ¥Ό μ •μν•λ ¤λ©΄ @Query μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•λ‹¤.

* μ‹¤ν–‰ν•  λ©”μ†λ“μ— μ •μ  μΏΌλ¦¬λ¥Ό μ§μ ‘ μ‘μ„±ν•λ―€λ΅ μ΄λ¦„ μ—†λ” Named μΏΌλ¦¬λΌκ³  ν•  μ μλ‹¤.

- μ• ν”λ¦¬μΌ€μ΄μ… μ‹¤ν–‰ μ‹μ μ— λ¬Έλ²• μ¤λ¥λ¥Ό λ°κ²¬ν•  μ μλ” μ¥μ μ΄ μλ‹¤.

```java
public interface MemberRepository extends JpaRepository<Member, Long>{

    @Query("select m from Member m where m.username = ?1") // μ§μ ‘ μ •μ  μΏΌλ¦¬λ¥Ό μ‘μ„±
    Member findByUsername(String username); // μ΄λ¦„ μ—†λ” Named μΏΌλ¦¬ μ‘μ„±λ²•
}
```

---

## νλΌλ―Έν„° λ°”μΈλ”©

- μ¤ν”„λ§ λ°μ΄ν„° JPA λ‹¤μμ νλΌλ―Έν„° λ°”μΈλ”© κΈ°λ²•λ“¤μ„ μ κ³µν•λ‹¤.

  > - μ„μΉ κΈ°λ° νλΌλ―Έν„° λ°”μΈλ”©
  >   - κΈ°λ³Έκ°’. μ½”λ“ κ°€λ…μ„±κ³Ό μ μ§€λ³΄μκ°€ μΆ‹λ‹¤.
  >   - `select m from Member m where m.username =?1`
  >
  > <br/>
  >
  > - μ΄λ¦„ κΈ°λ° νλΌλ―Έν„° λ°”μΈλ”©
  >   - @Param μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•λ‹¤.
  >   - `select m from Member m where m.username = :name`

- νλΌλ―Έν„° λ°”μΈλ”©

  ```java
  import org.springframework.data.repository.query.Param

  public interface MemberRepository extends JpaRepository<Member, Long> {

    @Query("select m from Member m where m.username = :name")
    Member findByUsername(@Param("name") String username);
  }
  ```

---

## λ²ν¬μ„± μμ • μΏΌλ¦¬

- μ¤ν”„λ§ λ°μ΄ν„° JPAλ¥Ό μ‚¬μ©ν• λ²ν¬μ„± μμ • μΏΌλ¦¬

```java

// λ²ν¬μ„± μμ •, μ‚­μ  μΏΌλ¦¬ μ‹ μ‚¬μ©ν•λ” μ–΄λ…Έν…μ΄μ…
@Modifying // (clearAutomatically = true) : λ²ν¬μ„± μΏΌλ¦¬ μ‹¤ν–‰ ν›„ μμ†μ„± μ»¨ν…μ¤νΈ μ΄κΈ°ν™”, κΈ°λ³Έκ°’μ€ false
@Query("update Product p set p.price = p.price * 1.1 where + p.stockAmount < :stockAmount")
int bulkPriceUp(@Param("stockAmount") String stockAmount);

```

---

## λ°ν™ νƒ€μ…

- μ¤ν”„λ§ λ°μ΄ν„° JPAλ” μ μ—°ν• λ°ν™ νƒ€μ… μ§€μ›

  - κ²°κ³Όκ°€ ν• κ±΄ μ΄μƒμ΄λ©΄ μ»¬λ ‰μ… μΈν„°νμ΄μ¤ μ‚¬μ© <br/>

    `List<Member> findByName(String name);` <br/>

  - κ²°κ³Όκ°€ λ‹¨κ±΄μ΄λ©΄ λ°ν™ νƒ€μ…μ„ μ§€μ • <br/>

    `Member findByEmail(String email)` <br/>

  - λ‚΄λ¶€μ μΌλ΅ Query.getSingleResult()λ¥Ό νΈμ¶ν•λ‹¤. <br/>

    μ΅°ν κ²°κ³Όκ°€ μ—†μΌλ©΄ μμ™Έκ°€ λ°μƒν•λ”λ° μ¤ν”„λ§ λ°μ΄ν„° JPAλ” μ΄λ° κ²½μ°, μμ™Έλ¥Ό λ¬΄μ‹ν•κ³  λ€μ‹ μ— null λ°ν™

* μ΅°ν κ²°κ³Όκ°€ μ—†μ„ κ²½μ°

  μ»¬λ ‰μ…μ€ λΉ μ»¬λ ‰μ… λ°ν™, λ‹¨κ±΄μ€ nullμ„ λ°ν™ν•λ‹¤.

- λ‹¨κ±΄μ„ κΈ°λ€ν•κ³  λ°ν™νƒ€μ… μ§€μ •ν–λ”λ° κ²°κ³Όκ°€ 2κ±΄ μ΄μƒ μ΅°νλλ©΄ μμ™Έ λ°μƒ.

---

## νμ΄μ§•κ³Ό μ •λ ¬

μΏΌλ¦¬ λ©”μ†λ“λ” νμ΄μ§•κ³Ό μ •λ ¬ κΈ°λ¥μ„ μ‚¬μ©ν•λ„λ΅ 2κ°€μ§€ νλΌλ―Έν„° μ κ³µ

- org.springframework.data.domain.Sort : μ •λ ¬κΈ°λ¥

* org.springframework.data.domain.Pageable : νμ΄μ§• κΈ°λ¥(λ‚΄λ¶€μ— Sort ν¬ν•¨)

- νλΌλ―Έν„°μ— Pageableμ„ μ‚¬μ©ν•λ©΄ λ°ν™νƒ€μ…μ€ List λ‚ Pageλ¥Ό μ‚¬μ© κ°€λ¥

  - Pageλ¥Ό μ‚¬μ©ν•λ©΄ μ¤ν”„λ§ λ°μ΄ν„° JPAλ” νμ΄μ§• κΈ°λ¥μ„ μ κ³µν•κΈ° μ„ν•΄ κ²€μƒ‰λ μ „μ²΄ λ°μ΄ν„° κ±΄μλ¥Ό μ΅°νν•λ” count μΏΌλ¦¬λ¥Ό μ¶”κ°€λ΅ νΈμ¶

  ```java
    // count μΏΌλ¦¬ μ‚¬μ©
    Page<Member> findByName(String name, Pageable pageable);

    // count μΏΌλ¦¬ μ‚¬μ© μ• ν•¨
    List<Member> findByName(String name, Pageable pageable);

    List<Member> findByName(String name, Sort sort);
  ```

- Page μ‚¬μ© μμ  μ‹¤ν–‰ μ½”λ“
  <br/>

  - Pageableμ€ μΈν„°νμ΄μ¤. λ”°λΌμ„ μ΄λ¥Ό κµ¬ν„ν• PageRequest κ°μ²΄λ¥Ό μ‚¬μ©. 0λ¶€ν„° μ‹μ‘<br/>
    `new PageRequest(ν„μ¬ νμ΄μ§€, μ΅°νν•  λ°μ΄ν„° μ, [μ •λ ¬ μ •λ³΄])`
    <br/>
    <br/>

  - μ΄λ¦„μ΄ κΉ€μΌλ΅ μ‹μ‘ν•λ” νμ› + μ΄λ¦„μΌλ΅ λ‚΄λ¦Όμ°¨μ + μ²« λ²μ§Έ νμ΄μ§€, νμ΄μ§€λ‹Ή λ³΄μ—¬μ¤„ λ°μ΄ν„°λ” 10κ±΄

  ```java
  //νμ΄μ§• μ΅°κ±΄κ³Ό μ •λ ¬ μ΅°κ±΄ μ„¤μ •
  PageRequest pageRequest =
      new PageRequest(0, 10, new Sort(Direction.DESC, "name));

  Page<Member> result =
      memberRepository.findByNameStartingWith("κΉ€", pageRequest);

  List<Member> members = result.getContent();     //μ΅°νλ λ°μ΄ν„°
  int totalPage = result.getTotalPages();         //μ „μ²΄ νμ΄μ§€ μ
  boolean hasNextPage = result.hasNextPage();     //λ‹¤μ νμ΄μ§€ μ΅΄μ¬ μ—¬λ¶€
  ```

π‘ Pageableκ³Ό Pageλ¥Ό μ‚¬μ©ν•λ©΄ μ§€λ£¨ν•κ³  λ°λ³µμ μΈ νμ΄μ§€ μ²λ¦¬λ¥Ό μ†μ‰½κ² κ°λ°

---

# μ‚¬μ©μ μ •μ λ¦¬ν¬μ§€ν† λ¦¬ κµ¬ν„

μ¤ν”„λ§ λ°μ΄ν„° JPA λ΅ λ¦¬ν¬μ§€ν† λ¦¬ κ°λ° μ‹ μΈν„°νμ΄μ¤λ§ μ •μν•κ³  κµ¬ν„μ²΄λ” λ§λ“¤μ§€ μ•λ”λ‹¤.

ν•μ§€λ§ λ‹¤μ–‘ν• μ΄μ λ΅ λ©”μ†λ¥Ό μ§μ ‘ κµ¬ν„ν•΄μ•Ό ν•  λ•λ„ μλ‹¤. -> λ¦¬ν¬μ§€ν† λ¦¬ μ§μ ‘ κµ¬ν„ μ‹ κ³µν†µμΈν„°νμ΄μ¤κ°€ μ κ³µν•λ” κΈ°λ¥κΉμ§€ λ¨λ‘ κµ¬ν„ν•΄μ•Όν•¨.

μ΄ κ²½μ° μ¤ν”„λ§ λ°μ΄ν„° JPAλ” ν•„μ”ν• λ©”μ†λ“λ§ κµ¬ν„ν•  μ μλ” λ°©λ²•μ„ μ κ³µν•λ‹¤.

1. μ‚¬μ©μ μ •μμΈν„°νμ΄μ¤λ¥Ό μ‘μ„±

```java
// μ‚¬μ©μ μ •μ μΈν„°νμ΄μ¤
public interface MemberRepositoryCustom {
  public List<Member> findMemberCustom();
}
```

2. μ‚¬μ©μ μ •μ μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν• ν΄λμ¤λ¥Ό μ‘μ„±ν•΄μ•Ό ν•λ‹¤.

   - μ΄λ¦„ μ§“λ” κ·μΉ™ : `λ¦¬ν¬μ§€ν† λ¦¬ μΈν„°νμ΄μ¤ μ΄λ¦„ + Impl` -> μ¤ν”„λ§ λ°μ΄ν„° JPAκ°€ μ‚¬μ©μ μ •μ κµ¬ν„ ν΄λμ¤λ΅ μΈμ‹

   ```java
   public class MemberRepositoryImpl implements MemberRepositoryCustom {

       @Override
     public List<Member> findMemberCustom(){
           ... // μ‚¬μ©μ μ •μ κµ¬ν„
       }
   }
   ```

3. λ¦¬ν¬μ§€ν† λ¦¬ μΈν„°νμ΄μ¤μ—μ„ μ‚¬μ©μ μ •μ μΈν„°νμ΄μ¤λ¥Ό μƒμ†

   ```java
   public interface MemberRepository extends JpaRepository<Member, Long>, MemberRepositoryCustom {

   }
   ```
