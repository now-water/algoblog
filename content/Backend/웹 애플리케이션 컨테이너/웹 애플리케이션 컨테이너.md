# 웹 애플리케이션 컨테이너

웹 애플리케이션이 배포되는 공간

### 웹 서버

HTML 같은 정적 파일들을 전달해주는 역할을 하는 서버

<hr/>

### 웹 애플리케이션 서버


`WAS (Web Applicaiton Server)` 라고도 부른다.

PHP, ASP, JSP 같은 언어들을 사용해서 동적인 페이지들을 생성할 수 있는 서버 (= 웹 애플리케이션 컨테이너)

WAS 가 웹 애플리케이션을 인식하고 동작시키는 방법을 알기 위해선 클래스 로더를 알아야한다.

웹 애플리케이션 자체 API를 제공하기 위해 컨테이너를 로드하는 `클래스 로더` 와 사용자가 추가한 JSP 나 WAR 파일들을 다루기 위한 `ServletContext Loader`를 사용한다.

<hr/>

### 클래스 로더

자바 코드 작성 후, 컴파일하면 해당 코드는 JVM 에서 실행 가능한 상태가 된다.

이때 JVM 이 클래스를 실행하기 위해서는 클래스를 로딩하는 과정이 필요하다. 그 과정을 수행해주는 역할을 한다.

클래스패스에 모듈 or 라이브러리를 추가하면 클래스 로더는 식별자로 클래스 메타 정보 중 첫 번째 시작 필드를 이용해 클래스를 로딩한다.

#### 특징

- 구조가 계층적이다

    - 상위 클래스 로더에서 하위 클래스 로더를 갖는 방식

    - 최상위 클래스 로더는 부트스트랩 클래스 로더이다


- 클래스 로딩 위임 가능


- 가시적인 규약이 있다

    - 가시적인 규약 : 클래스를 로딩할 때 가능한 범위

    - 자식 클래스 로더는 클래스 로딩 요청 위임을 통해 부모 클래스 로더가 로딩한 클래스를 찾을 수 있지만, 부모 클래스 로더는 자식 클래스 로더가 로딩한 클래스를 알 수 없다.


- 클래스 언로딩이 불가능

    - 클래스 로더가 로딩한 클래스를 언로드할 수 없으므로 가비지 컬렉터가 동작하거나 WAS 재 시작시 초기화.


#### 유형

1. Bootstrap Class Loader

    JVM 런타임 실행을 위해 기반이 되는 파일들을 로드. `rt.jar` 파일과 연관


2. Extension Class Loader

    자바 최상위 객체인 `Object` 를 포함한 자바 API 를 로드


3. System Class Loader

    클래스 패스에 포함된 클래스들을 로드.

    클래스 패스 : 사용자가 접근할 수 있는 영역. 로컬에서 외부 라이브러리 실행 시 클래스 패스를 지정해서 실행하기도 한다.


4. User-Defined Class Loader

<hr/>

### WAR 파일

`Web Application Archive` 또는 `Web Application Resource` 를 뜻한다

압축 파일에 자바 관련 규약이 포함된 것 => `WEB-INF`

웹 개발 시 결과물이 되는 형식

`WAS` 는 WAR 파일의 WEB-INF 폴더를 기준으로 클래스 파일들을 로드

#### 배포

- 로컬 실행 프로그램은 `JAR` 로 패키징

  (Gradle 을 통해 빌드 시 `build.gradle` 파일에 Jar 파일 추가해서 사용 가능)


- 웹은 `WAR` 로 패키징

      Web Archive
      |
      |--- WEB-INF
           |
           |-- content directory  : .html, .js, .css 파일
           |
           |-- classes : .java 파일
           |
           |-- libs : .jar 파일 (외부 라이브러리 파일) 사용자 정의 클래스 로더
                                (애플리케이션 로더를 통해 클래스 패스에 추가됨)


<hr/>

### 웹 애플리케이션 클래스 로더

클래스 로더 유형 중 시스템 클래스 로더 하위에 사용자가 정의한 클래스 로더

```java
 System Class Loader
        ⬆
  ServletContainer
        ⬆
  ServletContext
```

```java
  |-----------|  |-----------|
  |  Classes  |  |           |
  |-----------|  |  Servlet  |
  | Libraries |  |           |
  |-----------|  |-----------|

  |--------------------------|
  |     WebAppClassLoader    |
  |--------------------------|
```

컨테이너가 시작되고 컨텍스트가 초기화되면 서블릿 스펙의 권장 사항에 따라 `WEB-INF/classes` 파일을 먼저 검색해서 로딩하고,

그 후에 `WEB-INF/libs` 에 있는 JAR 파일들을 로드한다.
